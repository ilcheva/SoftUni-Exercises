<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>My Movies Title</title>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <h2 id="sub-header">Please login</h2>
        <div class="login-form">
            <label for="username">Username: </label>
            <input type="text" id="username" />
            <label for="password">Password: </label>
            <input type="password" id="password" />
            <button id="login-button">Login</button>
        </div>

        <div class="add-movie">
            <label for="title">Title: </label>
            <input type="text" id="title" />
            <label for="director">Director: </label>
            <input type="text" id="director" />
            <label for="img-url">Image url:</label>
            <input type="text" id="image-url" />
            <button id="add-movie-button">Add Movie</button>
        </div>

        <ul id="movies"></ul>
        <h2>Movie Details</h2>
        <div id="movie-details">Please Select Movie</div>

        <script src="auth.js"></script>
        <script>
            const baseUrl =
                "https://my-movies-a0d70-default-rtdb.europe-west1.firebasedatabase.app";
            let moviesElement = document.getElementById("movies");
            let moviesDetailsElement = document.getElementById("movie-details");
            let addMovieBtn = document.getElementById("add-movie-button");

            fetch(`${baseUrl}/movies.json`)
                .then((res) => res.json())
                .then((data) => {
                    let movieTitles = Object.keys(data)
                        .map(
                            (key) =>
                                `<li class ="movie-item" data-key=${key}>${data[key].title}</li>`
                        )
                        .join("");

                    moviesElement.innerHTML = movieTitles;
                });
            moviesElement.addEventListener("click", (e) => {
                let movieId = e.target.dataset.key;
                fetch(`${baseUrl}/movies/${movieId}.json`)
                    .then((res) => res.json())
                    .then((movie) => {
                        moviesDetailsElement.innerHTML = `${movie.title} - ${movie.director}`;
                        moviesDetailsElement.appendChild()
                    });
            });
            addMovieBtn.addEventListener("click", (e) => {
                let title = document.getElementById("title");
                let director = document.getElementById("director");
                let imgUrl = document.getElementById("image-url");
                let newMovie = {
                    title: title.value,
                    director: director.value,
                    imageUrl: imgUrl.value,
                };
                fetch(`${baseUrl}/movies/.json`, {
                    method: "POST",
                    body: JSON.stringify(newMovie),
                })
                    .then((res) => res.json())
                    .then((data) => {
                        let newMovieElement = document.createElement("li");
                        newMovieElement.innerText = newMovie.title;
                        newMovieElement.dataset["key"] = data.name;
                        newMovieElement.classList.add("movie-item");
                        moviesElement.appendChild(newMovieElement);
                    });
            });
        </script>
    </body>
</html>
